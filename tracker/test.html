<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kaunta Tracker Test Page</title>

  <!-- Kaunta Tracker -->
  <script
    defer
    data-website-id="550e8400-e29b-41d4-a716-446655440000"
    data-api-url="http://localhost:8080"
    data-auto-track="true"
    data-track-outbound="true"
    data-respect-dnt="false"
    src="kaunta.js">
  </script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }

    .section {
      margin: 40px 0;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
    }

    h1 {
      color: #333;
      border-bottom: 3px solid #4CAF50;
      padding-bottom: 10px;
    }

    h2 {
      color: #555;
      margin-top: 0;
    }

    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background: #45a049;
    }

    button:active {
      transform: scale(0.98);
    }

    .link-section a {
      display: block;
      margin: 10px 0;
      color: #2196F3;
      text-decoration: none;
      padding: 10px;
      border: 1px solid #2196F3;
      border-radius: 4px;
    }

    .link-section a:hover {
      background: #E3F2FD;
    }

    .scroll-content {
      height: 2000px;
      background: linear-gradient(to bottom, #fff, #f0f0f0);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #888;
    }

    .status {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #333;
      color: white;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 300px;
    }

    .status div {
      margin: 5px 0;
    }

    code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }

    .console-log {
      background: #f5f5f5;
      border-left: 3px solid #4CAF50;
      padding: 10px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
      overflow-x: auto;
    }
  </style>
</head>
<body>

  <h1>üî• Kaunta Tracker Test Page</h1>

  <div class="section">
    <h2>üìä Status</h2>
    <p>Open your browser's DevTools (F12) and go to the <strong>Network</strong> tab. Filter by <code>send</code> to see tracking requests.</p>
    <div class="console-log" id="log">
      Waiting for events...
    </div>
  </div>

  <div class="section">
    <h2>üéØ Custom Event Tracking</h2>
    <p>Click buttons to send custom events:</p>

    <button onclick="testSimpleEvent()">
      Simple Event
    </button>

    <button onclick="testEventWithProps()">
      Event with Properties
    </button>

    <button onclick="testComplexEvent()">
      Complex Event
    </button>

    <button onclick="testEcommerce()">
      E-commerce Event
    </button>
  </div>

  <div class="section">
    <h2>üîó Outbound Link Tracking</h2>
    <p>Click these links (they'll be tracked before opening):</p>
    <div class="link-section">
      <a href="https://google.com" target="_blank">Google (new tab)</a>
      <a href="https://github.com">GitHub (same tab - will delay 500ms)</a>
      <a href="https://example.com">Example.com</a>
    </div>
  </div>

  <div class="section">
    <h2>üß≠ SPA Navigation Test</h2>
    <p>Test single-page app navigation tracking:</p>

    <button onclick="testNavigation('/page1')">Navigate to /page1</button>
    <button onclick="testNavigation('/page2')">Navigate to /page2</button>
    <button onclick="testNavigation('/page3')">Navigate to /page3</button>
    <button onclick="history.back()">Go Back (popstate)</button>
  </div>

  <div class="section">
    <h2>üìú Scroll Depth Tracking</h2>
    <p>Scroll down this page to test scroll depth tracking. The scroll depth is sent with every event.</p>
  </div>

  <div class="section">
    <h2>‚è±Ô∏è Engagement Time Tracking</h2>
    <p>Wait on this page for a few seconds, then click a button. The engagement time (in milliseconds) will be included.</p>
    <p>Try switching tabs and coming back - engagement time only counts when you're actively viewing the page.</p>
  </div>

  <div class="section">
    <h2>üîç Manual Testing</h2>
    <p>Test via browser console:</p>
    <div class="console-log">
// Check if loaded<br>
console.log(window.kaunta);<br>
<br>
// Track custom event<br>
kaunta.track('console_test', { foo: 'bar' });<br>
<br>
// Manual pageview<br>
kaunta.trackPageview();<br>
    </div>
  </div>

  <!-- Scroll content -->
  <div class="scroll-content">
    üëá Scroll to increase scroll depth üëá
  </div>

  <!-- Live status display -->
  <div class="status" id="status">
    <div><strong>üìä Kaunta Status</strong></div>
    <div id="status-loaded">Loading...</div>
    <div id="status-time">Engagement: 0s</div>
    <div id="status-scroll">Scroll: 0%</div>
    <div id="status-events">Events: 0</div>
  </div>

  <script>
    // Logging helper
    var eventCount = 0;
    var logEl = document.getElementById('log');

    function log(message, data) {
      eventCount++;
      var timestamp = new Date().toLocaleTimeString();
      var dataStr = data ? '\n' + JSON.stringify(data, null, 2) : '';
      logEl.innerHTML = `[${timestamp}] ${message}${dataStr}\n\n` + logEl.innerHTML;

      // Update status
      document.getElementById('status-events').textContent = `Events: ${eventCount}`;
    }

    // Test functions
    function testSimpleEvent() {
      kaunta.track('simple_event');
      log('‚úÖ Tracked simple event', { name: 'simple_event' });
    }

    function testEventWithProps() {
      var props = {
        button: 'test_button',
        location: 'section_2',
        timestamp: Date.now()
      };
      kaunta.track('button_click', props);
      log('‚úÖ Tracked event with properties', { name: 'button_click', props });
    }

    function testComplexEvent() {
      var props = {
        category: 'user_interaction',
        action: 'form_interaction',
        label: 'newsletter_signup',
        value: 1,
        metadata: {
          form_id: 'newsletter_123',
          position: 'footer'
        }
      };
      kaunta.track('form_interaction', props);
      log('‚úÖ Tracked complex event', { name: 'form_interaction', props });
    }

    function testEcommerce() {
      var props = {
        product_id: 'PROD-001',
        product_name: 'Analytics Pro',
        category: 'SaaS',
        price: 29.99,
        currency: 'USD',
        quantity: 1
      };
      kaunta.track('add_to_cart', props);
      log('‚úÖ Tracked e-commerce event', { name: 'add_to_cart', props });
    }

    function testNavigation(path) {
      history.pushState({}, '', path);
      log('üß≠ Navigated to ' + path);
      // Kaunta will auto-track this
    }

    // Status updater
    setInterval(function() {
      if (window.kaunta) {
        document.getElementById('status-loaded').textContent = '‚úÖ Loaded';
      }

      // Calculate engagement time (rough estimate)
      var startTime = window.kauntaStartTime || Date.now();
      window.kauntaStartTime = window.kauntaStartTime || startTime;
      var elapsed = Math.floor((Date.now() - startTime) / 1000);
      document.getElementById('status-time').textContent = `Engagement: ${elapsed}s`;

      // Calculate scroll depth
      var scrollTop = window.scrollY || document.documentElement.scrollTop;
      var docHeight = Math.max(
        document.body.scrollHeight,
        document.documentElement.scrollHeight
      );
      var windowHeight = window.innerHeight;
      var scrollPercent = Math.round(((scrollTop + windowHeight) / docHeight) * 100);
      document.getElementById('status-scroll').textContent = `Scroll: ${scrollPercent}%`;
    }, 1000);

    // Log initial pageview
    window.addEventListener('load', function() {
      log('üéØ Initial pageview tracked automatically');
    });

    // Log SPA navigation
    var originalPushState = history.pushState;
    history.pushState = function() {
      originalPushState.apply(history, arguments);
      setTimeout(function() {
        log('üéØ SPA pageview tracked (pushState)');
      }, 350);
    };

    window.addEventListener('popstate', function() {
      setTimeout(function() {
        log('üéØ SPA pageview tracked (popstate)');
      }, 350);
    });
  </script>

</body>
</html>
